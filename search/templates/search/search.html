{% extends "base.html" %}

{% block content %}

    <form action="{% url 'search' %}" method="post">
        {% csrf_token %}
        <input type="text" name="search_query" placeholder="Search...">
        <label for="people">People</label>
        <input id="people" type="radio" name="search_type" value="people">
        <label for="communities">Communities</label>
        <input id="communities" type="radio" name="search_type" value="communities">
        <input type="submit">
    </form>

    {% if search_results_people %}
        <h2>Search results:</h2>
        <ul>
            {% for person in search_results_people %}
                <li>
                    <a href="{% url 'user_profile' person.user.username %}">
                        {{ person }} 

                    </a>
                    {% if person in user.profile.friends.all %}
                        <button class="removeFriend" data-id="{{ person.id }}">Unfriend</button>
                    {% else %}
                        <button class="addFriend" data-id="{{ person.id }}">Add friend</button>

                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    <script>
        const addFriendUrl = "{% url 'send-friend-request' %}";
        const removeFriendUrl = "{% url 'remove-friend' %}";
        

        $('.addFriend').click(function() {
            const id = $(this).data('id');
            $.ajax({
                url: addFriendUrl,
                method: 'POST',
                data: {
                    'id': id,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(data) {
                    console.log(data);
                    // need to replace the button with the message that the request has been sent
                    $('.addFriend[data-id=' + id + ']').replaceWith('<span>Friend request sent</span>');
                }
            });
        });

        $('.removeFriend').click(function() {
            const id = $(this).data('id');
            $.ajax({
                url: removeFriendUrl,
                method: 'POST',
                data: {
                    'id': id,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(data) {
                    console.log(data);
                    // need to replace the button with the add friend button
                    $('.removeFriend[data-id=' + id + ']').replaceWith('<button class="addFriend" data-id="' + id + '">Add friend</button>'); 
                }
            });
        });

        
        
    </script>

{% endblock %}